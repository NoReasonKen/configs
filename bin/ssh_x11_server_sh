#!/u/chehuang/bin/bash
help="Usage: ssh_x11_server_sh [<OPTION>...] <COMMAND>
Send command to x11 server via ssh
options:
    -x, --x11-server        Use specified ip(host) instead of env '__X11_SERVER'
    -v, --verbose           Show verbose messages in console
    -h, --help              Display this help and exit

usage:
    - Run xclock on x11 server
        ssh_x11_server_sh \"~/bin/zsh -c \\\"xclock\\\"\"
    - Run xclock on specified server
        ssh_x11_server_sh -x my_host \"~/bin/zsh -c \\\"xclock\\\"\"
"

source "/u/chehuang/bin/utils_src"
PATH=/u/chehuang/bin:$PATH

x11_server="$__X11_SERVER"
command=""
verbose=false
while [[ $# -gt 0 ]]; do
    case $1 in
        -x|--x11-server)
            shift; x11_server="$1"
            ;;
        -v|--verbose)
            verbose=true
            ;;
        -h|--help)
            echo "$help" && exit 0
            ;;
        *)
            command="$1"
            ;;
    esac
    shift
done

utils::verbose -c "${CYAN}" "x11-server=$x11_server; command=$command; verbose=$verbose\n"

if [[ -z "$x11_server" ]]; then
    utils::ERROR "No x11-server specified, please either explicitly set --x11-server or" \
        "set env '__X11_SERVER'\n" >&2
    exit 1
fi
if [[ -z "$command" ]]; then
    utils::ERROR "Empty command\n" >&2
    exit 1
fi

ssh -t -X "$x11_server" "$command"

